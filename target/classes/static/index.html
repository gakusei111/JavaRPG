<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Java RPG Web Edition</title>
<style>
        /* 全体の背景を「冒険っぽい」色に */
        body { 
            background-color: #202028; 
            color: #fff; 
            font-family: 'Courier New', sans-serif; /* 等幅フォントでレトロ感 */
            text-align: center; 
        }

        /* ログウィンドウを「RPGのメッセージ枠」風に */
        #log-window { 
            background: #000; 
            border: 4px double #fff; /* 二重線で高級感 */
            border-radius: 8px;      /* 角を丸く */
            width: 80%; 
            max-width: 600px;        /* 広がりすぎないように */
            height: 300px; 
            margin: 20px auto; 
            overflow-y: scroll; 
            padding: 20px; 
            text-align: left;
            font-size: 16px;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.2); /* ほんのり光らせる */
        }

        /* 1行ごとの演出 */
        .log-entry { 
            margin-bottom: 8px; 
            border-bottom: 1px dashed #444; 
            padding-bottom: 4px; 
            animation: fadeIn 0.5s ease-in; /* ふわっと表示させるアニメーション */
        }

        /* ボタンのデザイン */
        button { 
            background-color: #8b0000; /* 暗めの赤 */
            color: white; 
            border: 2px solid #ff4500; 
            padding: 10px 30px; 
            font-size: 18px; 
            font-weight: bold;
            cursor: pointer; 
            transition: 0.3s;
        }
        button:hover {
            background-color: #ff4500; /* マウスを乗せると明るくなる */
        }

        /* アニメーションの定義 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <h1>⚔️ Java RPG Battle ⚔️</h1>
    

    <div>
    <label>勇者: <input type="text" id="playerName" value="勇者" size="10"></label>
    <select id="job1">
        <option value="Swordsman">剣士</option>
        <option value="Mage">魔法使い</option>
        <option value="Healer">ヒーラー</option>
        <option value="Knight">騎士</option>
    </select>
    <br>
    <label>仲間A: 
        <select id="job2">
            <option value="Swordsman">剣士</option>
            <option value="Mage" selected>魔法使い</option>
            <option value="Healer">ヒーラー</option>
            <option value="Knight">騎士</option>
        </select>
    </label>
    <br>
    <label>仲間B: 
        <select id="job3">
            <option value="Swordsman">剣士</option>
            <option value="Mage">魔法使い</option>
            <option value="Healer" selected>ヒーラー</option>
            <option value="Knight">騎士</option>
        </select>
    </label>
    <button onclick="startBattle()">冒険に出る！</button>
</div>


    <div id="log-window">
        <div class="log-entry">冒険の準備が整いました。</div>
    </div>

<script>
    async function startBattle() {
        const name = document.getElementById('playerName').value;
        const job1 = document.getElementById('job1').value;
        const job2 = document.getElementById('job2').value;
        const job3 = document.getElementById('job3').value;

        const logWindow = document.getElementById('log-window');
        logWindow.innerHTML = "戦闘開始中...";

        try {
            // 3つの職業をクエリパラメータで送る
            const response = await fetch(`/api/battle?name=${name}&job1=${job1}&job2=${job2}&job3=${job3}`);
            const logs = await response.json();

                // 画面をリセットしてログを表示
                logWindow.innerHTML = "";
                logs.forEach(log => {
                    const div = document.createElement('div');
                    div.className = 'log-entry';
                    div.innerText = log; // 文字列リストの場合
                    logWindow.appendChild(div);
                });
            } catch (error) {
                logWindow.innerHTML = "エラーが発生しました: " + error;
            }
        }
        async function loadHistory() {
    const list = document.getElementById('history-list');
    list.innerHTML = "読み込み中...";

    try {
        // Java で作った @GetMapping("/history") を叩く
        const response = await fetch('/api/history');
        const history = await response.json();

        list.innerHTML = ""; // 表示をクリア
        
        // 最新の 5 件を表示（新しい順にしたい場合は reverse() を使う）
        history.reverse().slice(0, 5).forEach(item => {
            const li = document.createElement('li');
            li.className = 'log-entry'; // 既存のスタイルを流用
            
            // 日付を読みやすく整形
            const date = new Date(item.createdAt).toLocaleString();
            
            li.innerHTML = `
                <span style="color: #888;">[${date}]</span><br>
                <strong>${item.enemyName}</strong> との戦闘 
                → <span style="color: ${item.winner === '勇者' ? '#00ff00' : '#ff4500'}">勝者: ${item.winner}</span>
            `;
            list.appendChild(li);
        });

        if (history.length === 0) {
            list.innerHTML = "まだ戦績はありません。";
        }
    } catch (error) {
        list.innerHTML = "履歴の取得に失敗しました: " + error;
    }
}

// ページを開いた時にも自動で読み込む
window.onload = loadHistory;
    </script>
    <hr style="margin-top: 40px; border: 1px double #444;">
<h2>過去の戦績（データベースから取得）</h2>
<button onclick="loadHistory()" style="background-color: #2e8b57; border-color: #3cb371;">履歴を更新</button>

<ul id="history-list" style="text-align: left; max-width: 600px; margin: 20px auto; list-style: none; padding: 0;">
    </ul>
</body>
</html>